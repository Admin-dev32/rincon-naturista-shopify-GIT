{%- comment -%}
  RNF Slideshow Hero
  - Add slide blocks to build the slideshow.
{%- endcomment -%}

{% assign has_slides = false %}
{% if section.blocks.size > 0 %}
  {% assign has_slides = true %}
{% endif %}

<section
  id="rnf-slideshow-{{ section.id }}"
  class="rnf-slideshow"
  data-rnf-slideshow
  data-fit-image="{{ section.settings.fit_height_to_image }}"
  data-autoplay="{{ section.settings.autoplay }}"
  data-autoplay-delay="{{ section.settings.autoplay_delay }}"
  style="
    --rnf-bg-color: {{ section.settings.background_color }};
    --rnf-min-height: {{ section.settings.min_height_value }}{{ section.settings.min_height_unit }};
  "
>
  {{ 'rnf-slideshow-hero.css' | asset_url | stylesheet_tag }}
  <script src="{{ 'rnf-slideshow-hero.js' | asset_url }}" defer></script>

  {% if has_slides %}
    <div class="rnf-slideshow__viewport" aria-roledescription="carousel" aria-label="Slideshow">
      <div class="rnf-slideshow__track" data-rnf-track>
        {% for block in section.blocks %}
          {% assign desktop_image = block.settings.desktop_image %}
          {% assign mobile_image = block.settings.mobile_image %}
          {% assign slide_index = forloop.index0 %}
          {% assign overlay_alpha = block.settings.overlay_opacity | divided_by: 100.0 %}
          <div
            class="rnf-slideshow__slide{% if forloop.first %} is-active{% endif %}"
            data-rnf-slide
            data-index="{{ slide_index }}"
            {{ block.shopify_attributes }}
          >
            <div class="rnf-slideshow__media">
              {% if desktop_image != blank %}
                <picture>
                  {% if mobile_image != blank %}
                    <source media="(max-width: 749px)" srcset="{{ mobile_image | image_url: width: 1400 }}">
                  {% endif %}
                  <img
                    src="{{ desktop_image | image_url: width: 2400 }}"
                    alt="{{ block.settings.alt_text | default: desktop_image.alt | escape }}"
                    loading="lazy"
                    class="rnf-slideshow__image"
                  >
                </picture>
              {% endif %}
              {% if block.settings.enable_overlay %}
                <div
                  class="rnf-slideshow__overlay"
                  style="--rnf-overlay-color: {{ '#000000' | color_modify: 'alpha', overlay_alpha }};"
                ></div>
              {% endif %}
            </div>

            {% if block.settings.heading != blank or block.settings.subheading != blank or block.settings.eyebrow != blank or block.settings.cta_label != blank %}
              <div
                class="rnf-slideshow__content rnf-align-{{ block.settings.text_align }} rnf-vertical-{{ block.settings.vertical_align }}"
              >
                <div class="rnf-slideshow__content-inner">
                  {% if block.settings.eyebrow != blank %}
                    <p class="rnf-slideshow__eyebrow">{{ block.settings.eyebrow }}</p>
                  {% endif %}
                  {% if block.settings.heading != blank %}
                    <h2 class="rnf-slideshow__heading">{{ block.settings.heading }}</h2>
                  {% endif %}
                  {% if block.settings.subheading != blank %}
                    <div class="rnf-slideshow__subheading">{{ block.settings.subheading }}</div>
                  {% endif %}
                  {% if block.settings.cta_label != blank and block.settings.cta_url != blank %}
                    <a class="rnf-slideshow__cta" href="{{ block.settings.cta_url }}">
                      {{ block.settings.cta_label }}
                    </a>
                  {% endif %}
                </div>
              </div>
            {% endif %}
          </div>
        {% endfor %}
      </div>

      {% if section.settings.show_arrows %}
        <button class="rnf-slideshow__arrow rnf-slideshow__arrow--prev" type="button" data-rnf-prev aria-label="Previous slide">
          <span aria-hidden="true">&#10094;</span>
        </button>
        <button class="rnf-slideshow__arrow rnf-slideshow__arrow--next" type="button" data-rnf-next aria-label="Next slide">
          <span aria-hidden="true">&#10095;</span>
        </button>
      {% endif %}

      {% if section.settings.show_dots %}
        <div class="rnf-slideshow__dots" role="tablist" aria-label="Slideshow pagination">
          {% for block in section.blocks %}
            <button
              class="rnf-slideshow__dot{% if forloop.first %} is-active{% endif %}"
              type="button"
              data-rnf-dot
              data-index="{{ forloop.index0 }}"
              aria-label="Go to slide {{ forloop.index }}"
              aria-pressed="{% if forloop.first %}true{% else %}false{% endif %}"
            ></button>
          {% endfor %}
        </div>
      {% endif %}
    </div>
  {% elsif request.design_mode %}
    <div class="rnf-slideshow__empty">
      <p>Add slides to the RNF Slideshow Hero section.</p>
    </div>
  {% endif %}
</section>

{% schema %}
{
  "name": "RNF Slideshow Hero",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "Autoplay",
      "default": true
    },
    {
      "type": "range",
      "id": "autoplay_delay",
      "label": "Autoplay delay (ms)",
      "min": 3000,
      "max": 9000,
      "step": 500,
      "default": 6000
    },
    {
      "type": "checkbox",
      "id": "fit_height_to_image",
      "label": "Fit section height to image",
      "default": true
    },
    {
      "type": "range",
      "id": "min_height_value",
      "label": "Fallback min height",
      "min": 320,
      "max": 900,
      "step": 20,
      "default": 520
    },
    {
      "type": "select",
      "id": "min_height_unit",
      "label": "Min height unit",
      "default": "px",
      "options": [
        { "value": "px", "label": "px" },
        { "value": "vh", "label": "vh" }
      ]
    },
    {
      "type": "checkbox",
      "id": "show_arrows",
      "label": "Show navigation arrows",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_dots",
      "label": "Show pagination dots",
      "default": true
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background color",
      "default": "#FFFFFF"
    }
  ],
  "blocks": [
    {
      "type": "slide",
      "name": "Slide",
      "settings": [
        {
          "type": "image_picker",
          "id": "desktop_image",
          "label": "Desktop image"
        },
        {
          "type": "image_picker",
          "id": "mobile_image",
          "label": "Mobile image"
        },
        {
          "type": "text",
          "id": "alt_text",
          "label": "Alt text"
        },
        {
          "type": "text",
          "id": "eyebrow",
          "label": "Eyebrow"
        },
        {
          "type": "text",
          "id": "heading",
          "label": "Heading"
        },
        {
          "type": "textarea",
          "id": "subheading",
          "label": "Subheading"
        },
        {
          "type": "text",
          "id": "cta_label",
          "label": "CTA label"
        },
        {
          "type": "url",
          "id": "cta_url",
          "label": "CTA link"
        },
        {
          "type": "select",
          "id": "text_align",
          "label": "Text alignment",
          "default": "left",
          "options": [
            { "value": "left", "label": "Left" },
            { "value": "center", "label": "Center" },
            { "value": "right", "label": "Right" }
          ]
        },
        {
          "type": "select",
          "id": "vertical_align",
          "label": "Vertical alignment",
          "default": "center",
          "options": [
            { "value": "top", "label": "Top" },
            { "value": "center", "label": "Center" },
            { "value": "bottom", "label": "Bottom" }
          ]
        },
        {
          "type": "checkbox",
          "id": "enable_overlay",
          "label": "Enable overlay",
          "default": true
        },
        {
          "type": "range",
          "id": "overlay_opacity",
          "label": "Overlay opacity",
          "min": 0,
          "max": 100,
          "step": 5,
          "default": 35
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "RNF Slideshow Hero",
      "blocks": [
        { "type": "slide" },
        { "type": "slide" }
      ]
    }
  ]
}
{% endschema %}
